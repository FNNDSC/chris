<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="../bower_components/chips-api/behaviors/chips-plugin-behavior.html">

<link rel="import" href="shared-styles.html">

<dom-module id="chris-filebrowser-plugin">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }

    </style>

    <div class="card">
      <div class="circle">3</div>
      <h1>Create feed from data</h1>

      <button on-click="_startPlugin">Start plugin</button>
      <dom-repeat items="[[plugins]]">
        <template>
          <div># [[item.data.name]]</div>
       </template>
      </dom-repeat>

      <button on-click="_fetchData">Fetch data</button>

      <dom-repeat items="[[data]]">
        <template>
          <div># [[item.data.upload_path]]</div>
       </template>
      </dom-repeat>

    </div>
  </template>

  <script>
    class ChrisFilerowserPlugin extends CHIPSPluginBehavior(Polymer.Element) {
      static get is() { return 'chris-filebrowser-plugin'; }

      static get properties() {
        return {
          ip: String,
          port: String,
          namespace: String,
          data: Array,
          plugins: Array,
        };
      }

      _fetchData() {
        this.dispatchEvent(
          new CustomEvent('fetch-data', {detail: {}}));
      }

      _startPlugin() {
        // start plugin sequence
        const data = {};
        data.auth = {
          type: 'token',
          token: sessionStorage.getItem('auth-token'),
        };

        // add templates
        data.body = {};
        data.body.template = {};
        data.body.template.data = [];

        // add data
            // data.body = {};
    // data.body.template = {};
    // data.body.template.data = [
            //     data.body.template.data.push(
    //       {name: 'patient_id', value: ''});
    //     data.body.data['patient_id'] = formattedPID;
    console.log(this.plugins);
        // const start = this.__startPlugin(this.$.API, this.target, data);
        // start.then(this.__wait.bind(this, 1000))
        //   .then((response) => {
        //     this.push('loadingSteps', 'Waiting for answer...');
        //     return response;
        //   })
        //   .then(this.__waitEndPlugin.bind(this, this.$.API, data))
        //   .then((response) => console.log(response))
        //   .catch((response) => console.log(response));
      }


    // };
    // //
    // data.body = {};
    // data.body.template = {};
    // data.body.template.data = [
    //   {name: 'aet', value: ''},
    //   {name: 'aec', value: ''},
    //   {name: 'server_ip', value: ''},
    //   {name: 'server_port', value: ''},
    // ];
    // data.body.data = this.settings;
    // const validPID = this.validatePatientID();
    // if (validPID) {
    //   const formattedPID = this.formatPatientID();
    //   if (formattedPID !== '') {
    //     data.body.template.data.push(
    //       {name: 'patient_id', value: ''});
    //     data.body.data['patient_id'] = formattedPID;
    //   }
    // }
    // this.loading = true;
    // this.loadingSteps = [];
    // this.loadingSteps.push('Starting PACS Query...');
    // // ready to start the query sequence!
    // const start = this.__startPlugin(this.$.API, this.target, data);
    // start.then((response) => {
    //     // console.log(response);
    //     this.instance = Number(response.data[0].data.id);
    //     this.push('loadingSteps', 'Contacting the PACS Server...');
    //     return response;
    //   })
    //   // https://github.com/FNNDSC/ChRIS_ultron_backEnd/issues/17
    //   .then(this.__wait.bind(this, 1000))
    //   .then((response) => {
    //     this.push('loadingSteps', 'Waiting for answer...');
    //     return response;
    //   })
    //   .then(this.__waitEndPlugin.bind(this, this.$.API, data))
    }

    window.customElements.define(ChrisFilerowserPlugin.is, ChrisFilerowserPlugin);
  </script>
</dom-module>
